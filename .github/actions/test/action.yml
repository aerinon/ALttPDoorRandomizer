name: â±ï¸Test
description: Test app
inputs:
  os-name:
    required: true
    description: OS to run on
  python-version:
    required: true
    description: Python version to install

#########
# actions
#########
# actions/checkout@v4.1.4
# actions/download-artifact@v4.1.7
# actions/upload-artifact@v4.3.3
# coactions/setup-xvfb@v1.0.1

runs:
  using: "composite"
  steps:
    # download pipline
    - name: ðŸ”½Download PipLine
      shell: bash
      run: |
        echo "ðŸ”½Download PipLine"
    - name: ðŸ”½Download PipLine
      uses: actions/download-artifact@v4.1.7
      with:
        name: pipline-test-${{ inputs.os-name }}-py${{ inputs.python-version }}
        path: ./resources/user/meta/manifests

    # run tests
    - name: ðŸ–¥ï¸Test
      shell: bash
      run: |
        echo "ðŸ–¥ï¸Test"
    - name: ðŸ–¥ï¸Test
      shell: bash
      run: |
        mkdir -p ./failures
        echo "" > ./failures/errors.txt
        python -m pip install tqdm
        python ./test/NewTestSuite.py
        python ./test/MysteryTestSuite.py

    # print failures
    - name: ðŸ’¬Print Failures
      if: failure()
      shell: bash
      run: |
        echo "ðŸ’¬Print Failures"
    - name: Print Failures
      if: failure()
      shell: bash
      run: |
        ERR_STRING="$(cat ./failures/errors.txt)"
        ERR_STRING="${ERR_STRING//'%'/'%25'}"
        ERR_STRING="${ERR_STRING//$'\n'/' | '}"
        ERR_STRING="${ERR_STRING//$'\r'/' | '}"
        ERR_STRING="${ERR_STRING//$'\n'/'%0A'}"
        ERR_STRING="${ERR_STRING//$'\r'/'%0D'}"
        echo "::error ::$ERR_STRING"

    # upload failures
    - name: ðŸ”¼Upload Failures
      if: failure()
      shell: bash
      run: |
        echo "ðŸ”¼Upload Failures"
    - name: ðŸ”¼Upload Failures
      if: failure()
      uses: actions/upload-artifact@v4.3.3
      with:
        name: failures-${{ inputs.os-name }}-py${{ inputs.python-version }}
        path: ./failures
