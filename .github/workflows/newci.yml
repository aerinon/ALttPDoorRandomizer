# workflow name
name: Build

# fire on
on: [
  push,
  pull_request
]

# stuff to do
jobs:
  diags:
    # diagnostics
    #  call checkout
    #  call install python
    #  print python version
    #  call install
    #  call analyze github actions
    #  install extra python modules
    #  run diagnostics
    name: ðŸ§®Diagnostics
    runs-on: ${{ matrix.os-name }}
    continue-on-error: True

    strategy:
      matrix:
        os-name: [
          # ubuntu-latest,  # ubuntu-22.04
          ubuntu-22.04,
          ubuntu-20.04,
          macos-latest,  # macos-12
          windows-latest # windows-2022
        ]
        python-version: [ "3.12" ]
    steps:
      # call checkout
      - name: âœ”ï¸Checkout commit
        uses: actions/checkout@v4.1.4
      # call install python
      - name: ðŸ’¿Install Python
        uses: actions/setup-python@v5.1.0
        with:
          python-version: ${{ matrix.python-version }}
      # print python version
      - name: ðŸPython Version
        shell: bash
        run: |
          python --version
      # call install
      - name: ðŸ’¿Call Install
        uses: ./.github/actions/install
        with:
          calling-job: diags
          os-name: ${{ matrix.os-name }}
          python-version: ${{ matrix.python-version }}
      # call analyze github actions
      - name: Analyze used GitHub Actions
        shell: bash
        run: |
          python ./resources/ci/common/list_actions.py
      # install extra python modules
      - name: ðŸ’¿Install extra Python Modules
        shell: bash
        run: |
          python -m pip install setuptools
      # run diagnostics
      - name: ðŸ§®Print Diagnostics
        shell: bash
        run: |
          python -m source.meta.run_diags

  install-test:
    # test
    #  call checkout
    #  call install
    #  run tests
    name: ðŸ’¿/â±ï¸
    runs-on: ${{ matrix.os-name }}
    continue-on-error: False

    strategy:
      matrix:
        os-name: [
          # ubuntu-latest,  # ubuntu-22.04
          ubuntu-22.04,
          ubuntu-20.04,
          macos-latest,  # macos-12
          windows-latest # windows-2022
        ]
        python-version: [ "3.12" ]
    steps:
      # call checkout
      - name: âœ”ï¸Checkout commit
        uses: actions/checkout@v4.1.4
      # call install
      - name: ðŸ’¿Call Install
        uses: ./.github/actions/install
        with:
          calling-job: test
          os-name: ${{ matrix.os-name }}
          python-version: ${{ matrix.python-version }}
      # call test
      - name: â±ï¸Call Test
        uses: ./.github/actions/test
        with:
          os-name: ${{ matrix.os-name }}
          python-version: ${{ matrix.python-version }}

  install-build:
    # build
    #  call checkout
    #  call install
    #  call build
    name: ðŸ’¿/ðŸ”¨
    runs-on: ${{ matrix.os-name }}
    needs: [install-test]
    continue-on-error: False

    strategy:
      matrix:
        os-name: [
          # ubuntu-latest,  # ubuntu-22.04
          ubuntu-22.04,
          ubuntu-20.04,
          macos-latest,  # macos-12
          windows-latest # windows-2022
        ]
        python-version: [ "3.12" ]
    steps:
      # call checkout
      - name: âœ”ï¸Checkout commit
        uses: actions/checkout@v4.1.4
      # call install
      - name: ðŸ’¿Call Install
        uses: ./.github/actions/install
        with:
          calling-job: build
          os-name: ${{ matrix.os-name }}
          python-version: ${{ matrix.python-version }}
      # call build
      - name: ðŸ”¨Call Build
        uses: ./.github/actions/build
        with:
          calling-job: build
          os-name: ${{ matrix.os-name }}
          python-version: ${{ matrix.python-version }}

  install-release-prepare:
    # prepare release
    #  call checkout
    #  install extra python modules
    #  call prepare release
    name: ðŸ’¿/ðŸ“€->ðŸ“¦
    runs-on: ${{ matrix.os-name }}
    needs: [install-build]
    continue-on-error: False

    strategy:
      matrix:
        os-name: [
          # ubuntu-latest,  # ubuntu-22.04
          ubuntu-22.04,
          ubuntu-20.04,
          macos-latest,  # macos-12
          windows-latest # windows-2022
        ]
        python-version: [ "3.12" ]
    steps:
      # call checkout
      - name: âœ”ï¸Checkout commit
        uses: actions/checkout@v4.1.4
      # install extra python modules
      - name: ðŸ’¿Install extra Python Modules
        shell: bash
        run: |
          python -m pip install setuptools
      # call prepare release
      - name: ðŸ“€->ðŸ“¦Prepare Release
        uses: ./.github/actions/release-prepare
        with:
          os-name: ${{ matrix.os-name }}
          python-version: ${{ matrix.python-version }}

  install-release-deploy:
    # create release
    #  call checkout
    #  install extra python modules
    #  call deploy release
    name: ðŸ“€->ðŸš€
    runs-on: ${{ matrix.os-name }}
    needs: [install-release-prepare]
    continue-on-error: False

    strategy:
      matrix:
        os-name: [
          # ubuntu-latest,  # ubuntu-22.04
          ubuntu-22.04
        ]
        python-version: [ "3.12" ]
    steps:
      # call checkout
      - name: âœ”ï¸Checkout commit
        uses: actions/checkout@v4.1.4
      # install extra python modules
      - name: ðŸ’¿Install extra Python Modules
        shell: bash
        run: |
          python -m pip install pytz requests
      # call deploy release
      - name: ðŸ“€->ðŸš€Deploy Release
        uses: ./.github/actions/release-deploy
        with:
          os-name: ${{ matrix.os-name }}
          python-version: ${{ matrix.python-version }}
